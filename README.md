This is a work in progress. More features and code cleanup will be done.